--事务：
    --事务完整性：在一个事务当中，所有逻辑操作要么成功，要么失败；   

```plsql
 《事务栗子--张三转账500給李四》
--声明变量
DECLARE
    v_z account_bank.balance%TYPE;
BEGIN
    --查询张三账户
    SELECT ab.balance INTO v_z FROM Account_bank ab WHERE ab.username='张三';
            
    --如果大于500
       IF(v_z>=500) THEN
           --从张三账户扣去500
           UPDATE account_bank ab SET ab.balance=ab.balance-500 WHERE ab.username='张三';
           --扣除成功
           IF(SQL%ROWCOUNT=1) THEN
               --从李四账户加上500
               UPDATE account_bank ab SET ab.balance=ab.balance+500 WHERE ab.username='李四';
               --扣除成功
               IF(SQL%ROWCOUNT=1) THEN
                   dbms_output.put_line('转账成功');
                   COMMIT;
               ELSE
                   dbms_output.put_line('转账失败');
                   ROLLBACK;
               END IF; 
           --扣除失败
           ELSE
               --提示“交易失败”
               dbms_output.put_line('扣除金额失败');
               --回滚
               ROLLBACK;
           END IF;
    --否则
    ELSE
        --提示“余额不足”
        dbms_output.put_line('余额不足');
    END IF;
END;

```



```
--《栗子--隔离--不可重复读》
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
DECLARE
    v_sal emp.sal%TYPE;
BEGIN
    SELECT sal INTO v_sal FROM emp WHERE empno=7788;
    dbms_output.put_line('第一次查询：员工7788薪资：'||v_sal);
    --lock.sleep这个需要权限
    dbms_lock.sleep(5);
    --（如果这里另一个事务更改了数据并提交，两次查询的结果则不一致）
    --(此时可以设置事务隔离权限为可序列化)
    SELECT sal INTO v_sal FROM emp WHERE empno=7788;
    dbms_output.put_line('第二次查询：员工7788薪资：'||v_sal);
END;
```

