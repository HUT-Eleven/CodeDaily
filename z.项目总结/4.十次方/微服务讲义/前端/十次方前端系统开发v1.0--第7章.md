# 十次方前端系统开发-第7章  

# 网站前台-吐槽与问答

学习目标：





# 1.吐槽列表与详细页

## 1.1吐槽列表页

### 1.1.1吐槽列表页数据渲染

吐槽列表页已经构建，我们现在来实现数据的渲染

（1）easyMock模拟数据

URL: spit/spit/search/{page}/{size}

Method: GET

```JSON
{
  "code": 20000,
  "flag": true,
  "message": "@string",
  "data|10": [{
    "id": "@string",
    "content": "我要吐槽~我要吐槽~我要吐槽~我要吐槽~我要吐槽~我要吐槽~我要吐槽~我要吐槽~我要吐槽~我要吐槽~我要吐槽~我要吐槽~我要吐槽~我要吐槽~",
    "publishtime": "@datetime",
    "thumbup": "@integer(60, 100)"
  }]
}
```

（2）api目录下创建spit.js

```js
import request from '@/utils/request'
const api_group = 'spit'
const api_name = 'spit'
export default {
  page(page,size) {   
    return request({
      url: `/${api_group}/${api_name}/search/${page}/${size}`,
      method: 'get'
    })
  }
}
```

（3）修改pages/spit/index.vue

```html
<template>
      <!--两列布局-->
    <div class="wrapper tag-item">
        <div class="fl left-list">
            <div class="tc-data-list">
    <div class="tc-list">
            <ul class="detail-list">            
                    <li v-for="(item,index) in items" :key="index" class="qa-item">
                        <div class="fl record">
                            <div class="number">
                                <div class="border useful">
                                    <p class="usenum"><a href="#" class="zan"><i class="fa fa-thumbs-up " aria-hidden="true"></i></a></p>
                                    <p class="zannum">
                                        {{item.thumbup}}
                                    </p>
                                </div>
                                <div class="border answer">
                                    <a href="#" class="star"><i class="fa fa-star-o" aria-hidden="true"></i></a>
                                </div>
                            </div>
                        </div>
                        <div class="info">
                            <p class="text">
                                <a href="~/assets/spit-detail.html" target="_blank">
                                    {{item.content}}
                                </a>
                            </p>
                            <div class="other">
                                <div class="fl date">
                                    <span>{{item.publishtime}}</span>
                                </div>
                                <div class="fr remark">
                                    <a href="#" data-toggle="modal" data-target="#shareModal" class="share"><i class="fa fa-share-alt" aria-hidden="true"></i> 分享</a>
                                    <a href="#" data-toggle="modal" data-target="#remarkModal" class="comment"><i class="fa fa-commenting" aria-hidden="true"></i> 回复</a>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix"></div>
                    </li>
            </ul>
</div>
        </div>
        <div class="fl right-tag">
            <div class="block-btn">
                <p>来个匿名吐槽，发泄一下你心中的怒火吧！</p>
                <a class="sui-btn btn-block btn-share" href="~/assets/spit-submit.html" target="_blank">发吐槽</a>
            </div>
        </div>
        <div class="clearfix"></div>
    </div>
</template>
<script>
import '~/assets/css/page-sj-spit-index.css'
import spitApi from '@/api/spit'
export default {
  asyncData({params, error}) {
    return spitApi.page(1, 10).then(res => {
        let tmp = res.data.data.map(item => {        
        return {
          ...item,
          zan: ''
        }
      })
      return {items: tmp}
    })
  }
}
</script>
```

### 1.1.2吐槽列表瀑布流

修改页面pages/spit/index.vue

```html
 <div class="tc-list" v-infinite-scroll="loadMore" >
```

修改pages/spit/index.vue ,添加pageNo用于记录页码

```js
  data() {
      return {
        pageNo: 1
      }
  },
```

增加方法

```js
    loadMore: function() {
        this.pageNo ++
        spitApi.page(this.pageNo, 10).then(res => {
            let tmp = res.data.data.map(item => {
                return {
                    ...item,
                    zan: ''
                }
            })
            this.items = this.items.concat(tmp )
        })
    }
```



## 1.2吐槽详情页

### 1.2.1构建吐槽详情页

（1）创建pages/spit/_id.vue 

```html
<template>
  <div class="wrapper">
                <!--引用组件-->
     <!--引用组件-->
    <!--两列布局-->
    <div class="wrapper tc-detail">
        <div class="fl left-list">
            <div class="tc-detail">
    <!-- 标题区 -->
    <div class="detail-tit">
        <div class="detail-author">
            <a href="javascript:;">luckness</a> 发布
        </div>
        <div class="detail-content">
            <p>今天入职腾讯，产品岗，普通非985211大学，上家是不到五十人创业小公司！16年毕业！找内推腾讯给的面试机会，五轮面试！可能是我把运气攒一起了！</p>
            <img src="~/assets/img/widget-tc-detail.png" alt="" />
        </div>
        <div class="detail-tool">
            <ul>
                <li><span class="star"><i class="fa fa-thumbs-o-up" aria-hidden="true"></i> 53</span></li>
                <li><a href="#" data-toggle="modal" data-target="#shareModal"><i class="fa fa-share-alt" aria-hidden="true"></i> 44</a></li>
                <li><a  data-toggle="modal" data-target="#remarkModal"><i class="fa fa-commenting" aria-hidden="true" ></i> 666</a></li>
            </ul>
        </div>
    </div>
    <!-- 弹出框分享 -->
    <div class="modal fade" id="shareModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">分享到</h4>
                    </div>
                    <div class="modal-body" style="overflow:hidden">
                        <div class="jiathis_style_32x32" >
                            <a class="jiathis_button_qzone"></a>
                            <a class="jiathis_button_tsina"></a>
                            <a class="jiathis_button_weixin"></a>
                            <a class="jiathis_button_cqq"></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    <!-- 弹出框评论 -->
    <div class="modal fade" id="remarkModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">发表评论</h4>
                    </div>
                    <div class="modal-body">
                        <div class="comment">
                            <span class="who"><img src="~/assets/img/asset-photo.png"/>匿名评论</span>: 今天入职腾讯，产品岗，普通非985211大学，上家是不到五十人创业小公司！16年毕业！找内推腾讯给的面试机会，五轮面试！可能是我把运气攒一起了！
                        </div>
                        <div class="form">
                            <textarea class="form-control" rows="5" placeholder="匿名评论"></textarea> 
                            <div class="remark">
                                <button class="sui-btn btn-info">发表</button>
                            </div>                             
                        </div>
                    </div>
                </div>
            </div>
        </div>
    <!-- 评论区 -->
    <div class="comment-area">
        <div class="comment-tit">
            <span>评论</span>
        </div>
        <ul class="comment-list">
            <li>
                <div class="item-photo">
                    <img src="~/assets/img/widget-widget-photo.png" alt="" />
                </div>
                <div class="item-content">
                    <p class="author"><a href="javascript:;">luckness</a> 发布</p>
                    <p class="content">运气+实力吧？不能谦虚哦，沙发！</p>
                </div>
                <div class="item-thumb">
                    <div><i class="fa fa-thumbs-o-up" aria-hidden="true"></i> 52</div>
                </div>
            </li>
            <li>
                <div class="item-photo">
                    <img src="~/assets/img/widget-widget-photo.png" alt="" />
                </div>
                <div class="item-content">
                    <p class="author"><a href="javascript:;">luckness</a> 发布</p>
                    <p class="content">运气+实力吧？不能谦虚哦，沙发！</p>
                </div>
                <div class="item-thumb">
                    <div><i class="fa fa-thumbs-o-up" aria-hidden="true"></i> 52</div>
                </div>
            </li>
            <li>
                <div class="item-photo">
                    <img src="~/assets/img/widget-widget-photo.png" alt="" />
                </div>
                <div class="item-content">
                    <p class="author"><a href="javascript:;">luckness</a> 发布</p>
                    <p class="content">内推我吧，条件一样，还要人么？内推我吧，条件一样，还要人么？内推我吧，条件一样，还要人么？内推我吧，条件一样，还要人么？内推我吧，条件一样，还要人么？内推我吧，条件一样，还要人么？内推我吧，条件一样，还要人么？内推我吧，条件一样，还要人么？</p>
                </div>
                <div class="item-thumb">
                    <div><i class="fa fa-thumbs-o-up" aria-hidden="true"></i> 52</div>
                </div>
            </li>
            <li>
                <div class="item-photo">
                    <img src="~/assets/img/widget-widget-photo.png" alt="" />
                </div>
                <div class="item-content">
                    <p class="author"><a href="javascript:;">luckness</a> 发布</p>
                    <p class="content">运气+实力吧？不能谦虚哦，沙发！</p>
                </div>
                <div class="item-thumb">
                    <div><i class="fa fa-thumbs-o-up" aria-hidden="true"></i> 52</div>
                </div>
            </li>
            <li>
                <div class="item-photo">
                    <img src="~/assets/img/widget-widget-photo.png" alt="" />
                </div>
                <div class="item-content">
                    <p class="author"><a href="javascript:;">luckness</a> 发布</p>
                    <p class="content">运气+实力吧？不能谦虚哦，沙发！</p>
                </div>
                <div class="item-thumb">
                    <div><i class="fa fa-thumbs-o-up" aria-hidden="true"></i> 52</div>
                </div>
            </li>
            <li>
                <div class="item-photo">
                    <img src="~/assets/img/widget-widget-photo.png" alt="" />
                </div>
                <div class="item-content">
                    <p class="author"><a href="javascript:;">luckness</a> 发布</p>
                    <p class="content">运气+实力吧？不能谦虚哦，沙发！</p>
                </div>
                <div class="item-thumb">
                    <div><i class="fa fa-thumbs-o-up" aria-hidden="true"></i> 52</div>
                </div>
            </li>
        </ul>
    </div>
</div>
        </div>
        <div class="fl right-tag">
            <div class="block-btn">
                <p>来个匿名吐槽，发泄一下你心中的怒火吧！</p>
                <a class="sui-btn btn-block btn-share" href="~/assets/spit-submit.html" target="_blank">发吐槽</a>
            </div>
        </div>
        <div class="clearfix"></div>
    </div>
        </div>
</template>
<script>
import '~/assets/css/page-sj-spit-detail.css'
export default {
  
}
</script>
```

（2）修改pages/spit/index.vue 页面链接

```HTML
<p class="text">                                    
<a :href="'./spit/'+item.id" target="_blank"> 
{{item.content}}          
</a>
</p>
```

### 1.2.2吐槽详情页数据渲染

（1）easyMock模拟数据

URL: spit/spit/{id}

Methos:  GET

```JSON
{
  "code": 20000,
  "flag": true,
  "message": "@string",
  "data": {
    "id": "@string",
    "nikename": "@string",
    "content": "我要吐槽~我要吐槽~我要吐槽~我要吐槽~我要吐槽~我要吐槽~我要吐槽~我要吐槽~我要吐槽~我要吐槽~我要吐槽~我要吐槽~我要吐槽~我要吐槽~",
    "publishtime": "@datetime",
    "thumbup": "@integer(60, 100)",
    "share": "@integer(60, 100)",
    "comment": "@integer(60, 100)"
  }
}
```

URL: spit/spit/commentlist/{id}   

Method: GET

```JSON
{
  "code": 20000,
  "flag": true,
  "message": "@string",
  "data|10": [{
    "id": "@string",
    "content": "我要评论我要评论我要评论我要评论我要评论我要评论",
    "nikename": "小雅",
    "publishtime": "@datetime",
    "thumbup": "@integer(60, 100)"
  }]
}
```

（2）修改api/spit.js

```js
  findById(id){
    return request({
      url: `/${api_group}/${api_name}/${id}`,
      method: 'get'
    })
  },
  commentlist(id){
    return request({
      url: `/${api_group}/${api_name}/commentlist/${id}`,
      method: 'get'
    })
  }
```

（3）修改pages/spit/_id.vue 

```html
<template>
  <div class="wrapper">
    <!--引用组件-->
    <!--两列布局-->
    <div class="wrapper tc-detail">
        <div class="fl left-list">
            <div class="tc-detail">
    <!-- 标题区 -->
    <div class="detail-tit">
        <div class="detail-author">
            <a href="javascript:;">{{pojo.nikename}}</a> 发布
        </div>
        <div class="detail-content" v-html='pojo.content'>
               
        </div>
        <div class="detail-tool">
            <ul>
                <li><span class="star"><i class="fa fa-thumbs-o-up" aria-hidden="true"></i> {{pojo.thumbup}}</span></li>
                <li><a href="#" data-toggle="modal" data-target="#shareModal"><i class="fa fa-share-alt" aria-hidden="true"></i> {{pojo.share}}</a></li>
                <li><a  data-toggle="modal" data-target="#remarkModal"><i class="fa fa-commenting" aria-hidden="true" ></i> {{pojo.comment}}</a></li>
            </ul>
        </div>
    </div> 
    <!-- 评论区 -->
    <div class="comment-area">
        <div class="comment-tit">
            <span>评论</span>
        </div>
        <ul class="comment-list">
            <li v-for="(item,index) in commentlist" :key="index">
                <div class="item-photo">
                    <img src="~/assets/img/widget-widget-photo.png" alt="" />
                </div>
                <div class="item-content">
                    <p class="author"><a href="javascript:;">{{item.nikename}}</a> 发布</p>
                    <p class="content" v-html='item.content'></p>
                </div>
                <div class="item-thumb">
                    <div><i class="fa fa-thumbs-o-up" aria-hidden="true"></i> {{item.thumbup}}</div>
                </div>
            </li>            
        </ul>
    </div>
</div>
        </div>
        <div class="fl right-tag">
            <div class="block-btn">
                <p>来个匿名吐槽，发泄一下你心中的怒火吧！</p>
                <a class="sui-btn btn-block btn-share" href="submit" target="_blank">发吐槽</a>
            </div>
        </div>
        <div class="clearfix"></div>
    </div>
        </div>
</template>
<script>
import '~/assets/css/page-sj-spit-detail.css'
import axios from 'axios'
import spitApi from '@/api/spit'
export default {
  asyncData ({ params, error }) {
       return axios.all([spitApi.findById(params.id),     spitApi.commentlist(params.id)]).then(
          axios.spread(function(pojo,commentlist){
              return {pojo:pojo.data.data,commentlist:commentlist.data.data}
          })
       )
    }
}
</script>
```

### 1.2.3吐槽分享

学员实现

# 2.吐槽点赞

## 2.1基本功能实现

（1）easyMock模拟数据

URL:  spit/spit/thumbup/{id}

Method: put

```json
{
  "code": 20000,
  "flag": true,
  "message": "执行成功"
}
```

（2）api/spit.js  增加方法

```js
  thumbup(id) {
    return request({
      url: `/${api_group}/${api_name}/thumbup/${id}`,
      method: 'put'
    })
  }
```

（3）修改pages/spit/index.vue

```js
    methods: {
        thumbup: function(id){//点赞
            spitApi.thumbup(id).then( res => {
                 if(res.data.flag){
                     alert('ok'+id);
                 }
            })
        }
    }
```

（3）点赞调用

```html
<p class="usenum" @click="thumbup(item.id)"><a href="#" class="zan"><i class="fa fa-thumbs-up " aria-hidden="true"></i></a></p>    
```

## 2.2样式处理

实现点赞后，大拇指图标变色。样式表已经写好，在li 的样式上加上color 即可

（1）修改pages/spit/index.vue  的代码部分

```js
<script>
import '~/assets/css/page-sj-spit-index.css'
import spitApi from '@/api/spit'
export default {
  asyncData({params, error}) {
    return spitApi.page(1, 10).then(res => {
      let tmp = res.data.data.map(item => {        
        return {
          ...item,
          zan: ''
        }
      })
      return {items: tmp}
    })
  },
  methods: {
    thumbup: function(index) {
      //点赞
      this.items[index].zan = 'color'
      spitApi.thumbup(this.items[index].id).then(res => {
        if (res.data.flag) {
        }
      })
    }
  }
}
</script>
```

（2）修改pages/spit/index.vue的html部分 

```html
<a href="#" class="zan">
   <i :class="'fa fa-thumbs-up '+item.zan" aria-hidden="true"></i>
</a>
```

## 2.3增加点赞数

修改pages/spit/index.vue  的代码部分

```js
  methods: {
    thumbup: function(index) {
        if(this.items[index].zan === 'color'){
            return 
        }
        //点赞
        this.items[index].zan = 'color'
        spitApi.thumbup(this.items[index].id).then(res => {
            if (res.data.flag) {
                this.items[index].thumbup++
            }
        })
    }
  }
```



# 3.富文本编辑框组件

## 3.1发吐槽

### 3.1.1构建页面

我们这里用到VUE常用的富文本编辑器vue-quill-editor

（1）安装vue-quill-editor

```
cnpm install vue-quill-editor --save
```

（2）plugins下创建nuxt-quill-plugin.js 

```js
import Vue from 'vue'
import VueQuillEditor from 'vue-quill-editor/dist/ssr'
Vue.use(VueQuillEditor)
```

（3）修改nuxt.config.js ,配置插件和样式

```js
  plugins: [
    { src: '~plugins/nuxt-quill-plugin.js', ssr: false }
  ],
  // some nuxt config...
  css: [
    'quill/dist/quill.snow.css',
    'quill/dist/quill.bubble.css',
    'quill/dist/quill.core.css'
  ],
```

（4）pages/spit/submit.vue 

```html
<template>   
  <section class="container">
    <div class="wrapper release-tc">
        <div class="release-box">
            <h3>发布吐槽</h3>
            <div class="quill-editor" 
                :content="content"
                @change="onEditorChange($event)"
                @blur="onEditorBlur($event)"
                @focus="onEditorFocus($event)"
                @ready="onEditorReady($event)"
                v-quill:myQuillEditor="editorOption">
            </div>
            <div class="btns">
                <button class="sui-btn btn-danger btn-release">发布</button>
            </div>               
            <div class="clearfix"></div>
        </div>
    </div>
  </section>
</template>

<script>
  export default {
    data () {
      return {
        content: '说点什么呢？',
        editorOption: {
          // some quill options
          modules: {
            toolbar: [
              [{ 'size': ['small', false, 'large'] }],
              ['bold', 'italic'],
              [{ 'list': 'ordered'}, { 'list': 'bullet' }],
              ['link', 'image']
            ]
          }
        }
      }
    },
    mounted() {
      console.log('app init, my quill insrance object is:', this.myQuillEditor)
    },
    methods: {
      onEditorBlur(editor) {
        console.log('editor blur!', editor)
      },
      onEditorFocus(editor) {
        console.log('editor focus!', editor)
      },
      onEditorReady(editor) {
        console.log('editor ready!', editor)
      },
      onEditorChange({ editor, html, text }) {
        console.log('editor change!', editor, html, text)
        this.content = html
      }
    }
  }
</script>

<style lang="scss" scoped>
  .container {
    width: 80%;
    margin: 0 auto;
    padding: 50px 0;

    .quill-editor {
      min-height: 200px;
      max-height: 400px;
      overflow-y: auto;
    }
  }
</style>
```

这里用到了scss，我们需要进行安装node-sass才能正常使用

（5）修改pages/spit/index.vue  链接到此页面

```html
<a class="sui-btn btn-block btn-share" href="./spit/submit" target="_blank">发吐槽</a>
```

### 3.1.2提交吐槽

（1）easyMock模拟数据

URL:spit/spit

Method: post

```json
{
  "code": 20000,
  "flag": true,
  "message": "执行成功"
}
```

（2）修改api/spit.js ，增加提交吐槽的方法

```js
  submit(content,parentid){
    return request({
      url: `/${api_group}/${api_name}`,
      method: 'post',
      data: {content,parentid}
    })
  }
```

（2）修改pages/spit/submit.vue  引入API

```JS
import spitApi from '@/api/spit'
```

在methods增加方法

```js
      doSubmit() {        
        spitApi.submit(this.content,0).then( res =>{
            if(res.data.flag){
                this.$message({
                        message: '发布成功',
                        type: 'success'
                })
                this.$router.push('/spit')
            }
        })
      }
```

$router.push()的作用是路由跳转。

（3）发布按钮调用方法

```html
<button class="sui-btn btn-danger btn-release" @click="doSubmit">发布</button>
```

## 3.2吐槽评论

### 3.2.1评论弹出框

我们这里的评论弹出框用的是elementUI的弹出框，需要在nuxt引入elementUI

（1）下载安装elementUI

```
cnpm install element-ui --save
```

（2）plugins文件夹下创建element-ui.js

```js
import Vue from 'vue'  
import ElementUI from 'element-ui'  
Vue.use(ElementUI) 
```

（3）修改nuxt.config.js，加入插件与样式

```js
  .......
  plugins: [
    .....
    { src: '~plugins/element-ui.js', ssr: true }
  ],
  // some nuxt config...
  css: [
	.....
    'element-ui/lib/theme-chalk/index.css'
  ],
  .........
```

（4）修改pages/spit/index.vue ,添加弹出框

```html
<el-dialog
      title="回复"
      :visible.sync="replyDialogVisible"
      width="40%"  >
      <span>{{pojo.content}}</span> 
      <span slot="footer" class="dialog-footer">
         <el-button @click="replyDialogVisible = false">取 消</el-button>
         <el-button type="primary" @click="replyDialogVisible = false">确 定</el-button>
      </span>
</el-dialog>
```

（5）修改pages/spit/index.vue，增加代码逻辑

```js
data() {
      return {
        replyDialogVisible: false,
        pojo:{}
      };
  },
 methods: {
    .......
    openReply : function(index) { //弹出回复窗口
        this.replyDialogVisible = true
        this.pojo=this.items[index]
    }
  }
```

（6）修改pages/spit/index.vue 中的回复链接

```html
 <a href="#" @click="openReply(index)" class="comment"><i class="fa fa-commenting" aria-hidden="true"></i> 回复</a>
```

### 3.2.2评论框富文本编辑器

（1）弹出框中放置富文本编辑器

```html
<div class="quill-editor" 
      :content="content"
      v-quill:myQuillEditor="editorOption">
</div>
```

（2）定义相关对象

```js
data() {
      return {
        ......
        content: '说点什么呢？',
        editorOption: {
          // some quill options
          modules: {
            toolbar: [
              [{ 'size': ['small', false, 'large'] }],
              ['bold', 'italic'],
              [{ 'list': 'ordered'}, { 'list': 'bullet' }],
              ['link', 'image']
            ]
          }
        }
      };
  },
```

### 3.2.3提交评论

修改pages/spit/index.vue ，增加提交回复的方法

```js
    doReply() {//提交回复
        spitApi.submit(this.content,this.pojo.id).then( res =>{
            if(res.data.flag){
                this.$message({
                    message: '提交成功',
                    type: 'success'
                });
                this.replyDialogVisible = false //关闭窗口
            }else{
                this.$message({
                    message: '提交出错',
                    type: 'error'
                });
            }
        })
    }
```

# 4.问答频道

## 4.1问答列表与标签导航

### 4.1.1标签导航

（1）easyMock模拟数据

URL: base/label/toplist

Method: GET

```JSON
{
  "flag": true,
  "code": 20000,
  "data": [{
      "id": "1",
      "labelname": "JAVA"
    },
    {
      "id": "2",
      "labelname": "PHP"
    },
    {
      "id": "3",
      "labelname": "前端"
    },
    {
      "id": "4",
      "labelname": "Python"
    }
  ]
}
```

（2）编写标签API  创建api/label.js

```js
import request from '@/utils/request'
import {getUser} from '@/utils/auth'
const api_group = 'base'
const api_name = 'label'
export default {
  toplist() {   
    return request({
      url: `/${api_group}/${api_name}/toplist`,
      method: 'get'
    })
  }
}
```

（3）修改pages/qa.vue

```html
<template>
  <div>
    <div class="tab-nav "> 
        <div class="wrapper"> 
            <ul class="fl sui-nav nav-tabs navbar-dark">            
            <router-link tag="li" to="/qa" active-class="active" exact  ><a> 首页</a></router-link>
            <router-link tag="li" :to="'/qa/label/'+item.id" active-class="active" v-for="(item,index) in labelList" :key="index"  >                
                <a>{{item.labelname}} </a>
            </router-link>            
            </ul> 
            <span class="fr more"><a href="./qa-allTag.html" target="_blank">更多</a></span> 
            <div class="clearfix"></div> 
        </div> 
    </div> 
    <nuxt-child/>
  </div>
</template>
<script>
import labelApi from '@/api/label'
export default {
    asyncData ({ params, error}) {        
        return labelApi.toplist().then((res) => {
            return {labelList: res.data.data  } 
        })      
    }
}
</script>
```

（4）创建pages/qa/index.vue

```html
<template>
  <div>
      这里是问答列表
  </div>
</template>
```

### 4.1.2最新问答列表

（1）easy-mock模拟数据

URL:/qa/problem/newlist/{page}/{pagesize}

Method:GET

```json
{
  "flag": true,
  "code": 20000,
  "data|10": [{
    "id": "@string",
    "title": "@string",
    "createtime": "@Date",
    "updatetime": "@datetime",
    "nikename": "@string",
    "visits": "@integer(60, 100)",
    "thumbup": "@integer(60, 100)",
    "reply": "@integer(60, 100)",
    "replyname": '小马',
    "labels": "java,php"
  }]
}
```

（2）API编写  创建api/problem.js

```js
import request from '@/utils/request'
const api_group = 'qa'
const api_name = 'problem'
export default {
  list(type,page,size) {   
    return request({
      url: `/${api_group}/${api_name}/${type}/${page}/${size}`,
      method: 'get'
    })
  }
}
```

（3）修改pages/qa/index.vue

```html
<template>
   <div class="wrapper qa-content"> 
   <div class="fl left-list"> 
    <div class="tab-content"> 
     <div id="index" class="tab-pane active"> 
      <div class="tab-bottom-line"> 
       <ul class="sui-nav nav-tabs"> 
        <li class="active"><a href="#new" data-toggle="tab">最新回答</a></li> 
        <li><a href="#hot" data-toggle="tab">热门回答</a></li> 
        <li><a href="#wait" data-toggle="tab">等待回答</a></li> 
       </ul> 
       <div class="qa-list"> 
        <div class="tab-content"> 
         <div id="new" class="tab-pane active"> 
          <ul class="detail-list"> 
           <li class="qa-item" v-for="(item,index) in list" :key="index" > 
            <div class="fl record"> 
             <div class="number"> 
              <div class="border useful"> 
               <p class="usenum">{{item.thumbup}}</p> 
               <p>有用</p> 
              </div> 
              <div class="border answer"> 
               <p class="ansnum">{{item.reply}}</p> 
               <p>回答</p> 
              </div> 
             </div> 
            </div> 
            <div class="fl info"> 
             <div class="question"> 
              <p class="author"><span class="name">{{item.replyname}}</span><span>{{item.updatetime}}</span>回复</p> 
              <p class="title"><a href="./qa-detail.html" target="_blank">{{item.title}}</a></p> 
             </div> 
             <div class="other"> 
              <ul class="fl sui-tag"> 
               <li v-for="(item,index) in item.labels.split(',')" :key="index">{{item}}</li>           
              </ul> 
              <div class="fr brower"> 
               <p>浏览量 {{item.visits}} | {{item.createtime}} 来自 <a href="#">{{item.nikename}} </a></p> 
              </div> 
             </div> 
            </div> 
            <div class="clearfix"></div> </li>            
          </ul>           
         </div> 
         <div id="hot" class="tab-pane"> 
          <p>热门回答</p> 
         </div> 
         <div id="wait" class="tab-pane"> 
          <p>等待回答</p> 
         </div> 
        </div> 
       </div> 
      </div> 
     </div> 
     <div id="php" class="tab-pane">
       php 
     </div> 
     <div id="js" class="tab-pane">
       Javascript 
     </div> 
     <div id="python" class="tab-pane">
       python 
     </div> 
     <div id="java" class="tab-pane">
       java 
     </div> 
    </div> 
   </div> 
   <div class="fl right-tag"> 
    <div class="block-btn"> 
     <p>今天，有什么好东西要和大家分享么?</p> 
     <a class="sui-btn btn-block btn-share" href="./qa-submit.html" target="_blank">发布分享</a> 
    </div> 
    <div class="hot-tags"> 
     <div class="head"> 
      <h3 class="title">热门标签</h3> 
     </div> 
     <div class="tags"> 
      <ul class="sui-tag"> 
       <li>Php</li> 
       <li>Javascript</li> 
       <li>Gif</li> 
       <li>Java</li> 
       <li>C#</li> 
       <li>iOS</li> 
       <li>C++</li> 
      </ul> 
     </div> 
    </div> 
   </div> 
   <div class="clearfix"></div> 
  </div> 
</template>
<script>
import '~/assets/css/page-sj-qa-logined.css'
import problemApi from '@/api/problem'
export default {
  asyncData({params,error}){
      return problemApi.list('newlist',1,10).then( res =>{
           return {list:  res.data.data}
      })
  }
}
</script>
```



### 4.1.3热门回答列表

（1）easy-mock模拟数据

URL: /qa/problem/hotlist/{page}/{pagesize}

Method: GET

内容同最新问答列表

（2）修改pages/qa/index.vue  代码部分

```js
  methods:{
    findList(type){
      problemApi.list(type,1,10).then( res =>{
           this.list= res.data.data
      })
    }
  }
```

（3）修改pages/qa/index.vue 页面部分 ,

```js
        <li class="active"><a @click="findList('newlist')">最新回答</a></li> 
        <li><a href="#hot" @click="findList('hotlist')">热门回答</a></li> 
```

### 4.1.4等待回答列表

（1）easy-mock模拟数据

URL: /qa/problem/waitlist/{page}/{pagesize}

Method: GET

内容同最新问答列表

（2）修改pages/qa/index.vue

```js
<li><a href="#wait" @click="findList('waitlist')">等待回答</a></li> 
```

（3）实现选中标签下划线效果，修改pages/qa/index.vue代码部分

```js
  data(){
    return {type:'newlist'}
  },
  methods:{
    findList(type){
      this.type = type
      problemApi.list(type,1,10).then( res =>{
           this.list= res.data.data
      })
    }
  }
```

页面用三目运算符来实现

```html
<li :class="type=='newlist'?'active':''"><a @click="findList('newlist')">最新回答</a></li> 
<li :class="type=='hotlist'?'active':''"><a href="#hot" @click="findList('hotlist')">热门回答</a></li> 
<li :class="type=='waitlist'?'active':''"><a href="#wait" @click="findList('waitlist')">等待回答</a></li> 
```

### 4.1.5某标签的问题列表

（1）easy-mock模拟数据

URL: /qa/problem/newlist/{label}/{page}/{pagesize}

Method: GET

内容同最新问答列表

（2）API编写。修改api/problem.js增加方法

```js
  listByLabelId(type,labelId,page,size) {   
    return request({
      url: `/${api_group}/${api_name}/${type}/${labelId}/${page}/${size}`,
      method: 'get'
    })
  }
```

（3）创建pages/qa/label/_label.vue

```html
<template>
   <div class="wrapper qa-content"> 
   <div class="fl left-list"> 
    <div class="tab-content"> 
     <div id="index" class="tab-pane active"> 
      <div class="tab-bottom-line"> 
       <ul class="sui-nav nav-tabs"> 
        <li :class="type=='newlist'?'active':''"><a @click="findList('newlist')">最新回答</a></li> 
        <li :class="type=='hotlist'?'active':''"><a href="#hot" @click="findList('hotlist')">热门回答</a></li> 
        <li :class="type=='waitlist'?'active':''"><a href="#wait" @click="findList('waitlist')">等待回答</a></li> 
       </ul> 
       <div class="qa-list"> 
        <div class="tab-content"> 
         <div id="new" class="tab-pane active"> 
          <ul class="detail-list"> 
           <li class="qa-item" v-for="(item,index) in list" :key="index" > 
            <div class="fl record"> 
             <div class="number"> 
              <div class="border useful"> 
               <p class="usenum">{{item.thumbup}}</p> 
               <p>有用</p> 
              </div> 
              <div class="border answer"> 
               <p class="ansnum">{{item.reply}}</p> 
               <p>回答</p> 
              </div> 
             </div> 
            </div> 
            <div class="fl info"> 
             <div class="question"> 
              <p class="author"><span class="name">{{item.replyname}}</span><span>{{item.updatetime}}</span>回复</p> 
              <p class="title"><a href="./qa-detail.html" target="_blank">{{item.title}}</a></p> 
             </div> 
             <div class="other"> 
              <ul class="fl sui-tag"> 
               <li v-for="(item,index) in item.labels.split(',')" :key="index">{{item}}</li>           
              </ul> 
              <div class="fr brower"> 
               <p>浏览量 {{item.visits}} | {{item.createtime}} 来自 <a href="#">{{item.nikename}} </a></p> 
              </div> 
             </div> 
            </div> 
            <div class="clearfix"></div> </li>            
          </ul>           
         </div> 
         <div id="hot" class="tab-pane"> 
          <p>热门回答</p> 
         </div> 
         <div id="wait" class="tab-pane"> 
          <p>等待回答</p> 
         </div> 
        </div> 
       </div> 
      </div> 
     </div> 
     <div id="php" class="tab-pane">
       php 
     </div> 
     <div id="js" class="tab-pane">
       Javascript 
     </div> 
     <div id="python" class="tab-pane">
       python 
     </div> 
     <div id="java" class="tab-pane">
       java 
     </div> 
    </div> 
   </div> 
   <div class="fl right-tag"> 
    <div class="block-btn"> 
     <p>今天，有什么好东西要和大家分享么?</p> 
     <a class="sui-btn btn-block btn-share" href="./qa-submit.html" target="_blank">发布分享</a> 
    </div> 
    <div class="hot-tags"> 
     <div class="head"> 
      <h3 class="title">热门标签</h3> 
     </div> 
     <div class="tags"> 
      <ul class="sui-tag"> 
       <li>Php</li> 
       <li>Javascript</li> 
       <li>Gif</li> 
       <li>Java</li> 
       <li>C#</li> 
       <li>iOS</li> 
       <li>C++</li> 
      </ul> 
     </div> 
    </div> 
   </div> 
   <div class="clearfix"></div> 
  </div> 
</template>
<script>
import '~/assets/css/page-sj-qa-logined.css'
import problemApi from '@/api/problem'
export default {
  asyncData({params,error}){
      return problemApi.listByLabelId('newlist',params.label,1,10).then( res =>{
           return {list:  res.data.data,  labelId:params.label}
      })
  },
  data(){
    return {type:'newlist'}
  },
  methods:{
    findList(type){
      this.type = type
      problemApi.listByLabelId(type,this.labelId,1,10).then( res =>{
           this.list= res.data.data
      })
    }
  }
}
</script>
```



## 4.2标签列表与关注标签

### 4.2.1页面构建

（1）页面构建  创建pages/label/index.vue

```html
<template>
  <div class="wrapper all-tags"> 
   <div class="tags-head"> 
    <h2 class="tag-title">标签</h2> 
    <p class="tag-second">标签是最有效的内容组织形式，正确的使用标签能更快的发现和解决你的问题。</p> 
   </div> 
   <div class="alltags-card" > 
    <ul class="yui3-g tags-list" style="display:block;"> 
     <li class="tag-item yui3-u-1-4"> 
      <div class="inner"> 
       <h5 class="title"><a href="qa-tagDetail.html" target="_blank">HTML5</a></h5> 
        <div class="guanzhu"> 
        <a class="sui-btn btn-guanzhu">加关注</a> 
        <span class="guannum"><i class="num">23456</i>人关注</span> 
       </div> 
      </div> </li> 
     <li class="tag-item yui3-u-1-4"> 
      <div class="inner"> 
       <h5 class="title"><a href="qa-tagDetail.html" target="_blank">Javascript</a></h5> 
       <div class="guanzhu"> 
        <a class="sui-btn btn-guanzhu">加关注</a> 
        <span class="guannum"><i class="num">5643</i>人关注</span> 
       </div> 
      </div> </li> 
     <li class="tag-item yui3-u-1-4"> 
      <div class="inner"> 
       <h5 class="title"><a href="qa-tagDetail.html" target="_blank">PHP</a></h5> 
       <div class="guanzhu"> 
        <a class="sui-btn btn-guanzhu">加关注</a> 
        <span class="guannum"><i class="num">23489</i>人关注</span> 
       </div> 
      </div> </li> 
     <li class="tag-item yui3-u-1-4"> 
      <div class="inner"> 
       <h5 class="title"><a href="qa-tagDetail.html" target="_blank">Python</a></h5> 
       <div class="guanzhu"> 
        <a class="sui-btn btn-guanzhu">加关注</a> 
        <span class="guannum"><i class="num">12323</i>人关注</span> 
       </div> 
      </div> </li> 
     <li class="tag-item yui3-u-1-4"> 
      <div class="inner"> 
       <h5 class="title"><a href="qa-tagDetail.html" target="_blank">Javascript</a></h5> 
       <div class="guanzhu"> 
        <a class="sui-btn btn-guanzhu">加关注</a> 
        <span class="guannum"><i class="num">5643</i>人关注</span> 
       </div> 
      </div> </li> 
     <li class="tag-item yui3-u-1-4"> 
      <div class="inner"> 
       <h5 class="title"><a href="qa-tagDetail.html" target="_blank">PHP</a></h5> 
        <div class="guanzhu"> 
        <a class="sui-btn btn-guanzhu">加关注</a> 
        <span class="guannum"><i class="num">23489</i>人关注</span> 
       </div> 
      </div> </li>      
    </ul> 
   </div> 
  </div> 
</template>
<script>
import '~/assets/css/page-sj-qa-allTag.css'
</script>
```

（2）更多链接

```html
<router-link to="/label">更多</router-link>
```

### 4.2.2标签列表获取数据

（1）easy-mock模拟数据

URL: /base/label/list

Method: get

```js
{
  "flag": true,
  "code": 20000,
  "data": [{
      "id": "1",
      "labelname": "JAVA",
      "fans": 10102,
      "isfans":true
    },
    {
      "id": "2",
      "labelname": "PHP",
      "fans": 1013,
      "isfans":true
    },
    {
      "id": "3",
      "labelname": "前端",
      "fans": 3411,
      "isfans":false
    },
    {
      "id": "4",
      "labelname": "Python",
      "fans": 131,
      "isfans":true
    },
    {
      "id": "5",
      "labelname": "Oracle",
      "fans": 3231,
      "isfans":false
    }
  ]
}
```

（2）API 编写  修改api/label.js

```js
  list() {   
    return request({
      url: `/${api_group}/${api_name}/list`,
      method: 'get'
    })
  }
```

（3）修改pages/label/index.vue

```html
<template>
  <div class="wrapper all-tags"> 
   <div class="tags-head"> 
    <h2 class="tag-title">标签</h2> 
    <p class="tag-second">标签是最有效的内容组织形式，正确的使用标签能更快的发现和解决你的问题。</p> 
   </div> 
   <div class="alltags-card" > 
    <ul class="yui3-g tags-list" style="display:block;"> 
     <li class="tag-item yui3-u-1-4" v-for="(item,index) in list" :key="index"> 
      <div class="inner"> 
       <h5 class="title"><a href="qa-tagDetail.html" target="_blank">{{item.labelname}}</a></h5> 
        <div class="guanzhu"> 
        <a class="sui-btn btn-guanzhu">加关注</a> 
        <span class="guannum"><i class="num">{{item.fans}}</i>人关注</span> 
       </div> 
      </div>
     </li>      
    </ul> 
   </div> 
  </div> 
</template>
<script>
import '~/assets/css/page-sj-qa-allTag.css'
import labelApi from '@/api/label'
export default {
     asyncData ({ params, error }) {
        return labelApi.list().then((res) => {        
            return { list: res.data.data }
        })      
    }  
}
</script>
```

### 4.2.3关注标签

（1）easy-mock模拟数据

URL:/base/label/addul/{labelid}

Method: PUT

```JSON
{
  "flag": true,
  "code": 20000,
  'message': "执行成功"
}
```

（2）API编写  修改api/label.js  增加方法

```js
  addul(labelid){
    return request({
      url: `/${api_group}/${api_name}/addul/${labelid}`,
      method: 'put'
    })
  }
```

（3）修改页面pages/label/index.vue

```html
<template>
  <div class="wrapper all-tags"> 
   <div class="tags-head"> 
    <h2 class="tag-title">标签</h2> 
    <p class="tag-second">标签是最有效的内容组织形式，正确的使用标签能更快的发现和解决你的问题。</p> 
   </div> 
   <div class="alltags-card" > 
    <ul class="yui3-g tags-list" style="display:block;"> 
     <li class="tag-item yui3-u-1-4" v-for="(item,index) in list" :key="index"> 
      <div class="inner"> 
       <h5 class="title"><a href="qa-tagDetail.html" target="_blank">{{item.labelname}}</a></h5> 
        <div class="guanzhu"> 
          <span v-if="item.isfans===false"><a class="sui-btn btn-guanzhu" @click="addul(item.id,index)">加关注</a> </span>
          <span v-if="item.isfans===true">已关注</span>
        <span class="guannum"><i class="num">{{item.fans}}</i>人关注</span> 
       </div> 
      </div>
     </li>      
    </ul> 
   </div> 
  </div> 
</template>
<script>
import '~/assets/css/page-sj-qa-allTag.css'
import labelApi from '@/api/label'
export default {
    asyncData ({ params, error }) {
        return labelApi.list().then((res) => {        
            return { list: res.data.data }
        })      
    },
    methods:{
        addul(id,index){
            this.list[index].isfans=true
            labelApi.addul(id).then( (res) => {
                if(res.data.flag){
                    this.list[index].fans++                    
                }
            })
        }
    }
}
</script>
```

## 4.3问答详细页

学员实现

## 4.4发布问题页

学员实现。使用富文本编辑器（参见吐槽模块的实现）


